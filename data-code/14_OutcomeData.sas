/* ------------------------------------------------------------ */
/* TITLE:		 Find Inpatient Stays from broader set to identify */
/*				 complications and readmissions					*/
/* AUTHOR:		 Ian McCarthy									*/
/* 				 Emory University								*/
/* DATE CREATED: 7/1/2019										*/
/* DATE EDITED:  7/4/2019										*/
/* CODE FILE ORDER: XX of XX  									*/
/* NOTES:														*/
/*   BENE_CC  Master beneficiary summary file 					*/
/*   MCBSxxxx Medicare Current Beneficiary Survey (Year xxxx) 	*/
/*   MCBSXWLK MCBS Crosswalk 									*/
/*   RIFSxxxx Out/Inpatient and Carrier claims (Year xxxx)  	*/
/*   Medpar   Inpatient claims  								*/
/*   -- File outputs the following tables to IMC969SL:			*/
/*		Outcomes_2007-2015  								*/
/* ------------------------------------------------------------ */


/* Create Table of Outcomes for 2007 */
DATA WORK.InpatientStays_2007;
	SET	RIF2007.INPATIENT_CLAIMS_01
  		RIF2007.INPATIENT_CLAIMS_02
		RIF2007.INPATIENT_CLAIMS_03
		RIF2007.INPATIENT_CLAIMS_04
		RIF2007.INPATIENT_CLAIMS_05
		RIF2007.INPATIENT_CLAIMS_06
		RIF2007.INPATIENT_CLAIMS_07
		RIF2007.INPATIENT_CLAIMS_08
		RIF2007.INPATIENT_CLAIMS_09
		RIF2007.INPATIENT_CLAIMS_10
		RIF2007.INPATIENT_CLAIMS_11
		RIF2007.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2007;
	CREATE TABLE WORK.AllStays_2007 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2007 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2007;
	CREATE TABLE WORK.SSI_2007 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2007
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2007;
	CREATE TABLE WORK.PrimarySSI_2007 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2007
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2007;
	CREATE TABLE WORK.Sepsis_2007 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2007
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2007;
	CREATE TABLE WORK.PrimarySepsis_2007 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2007
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2007;
	CREATE TABLE WORK.AdmitsOnly_2007 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2007;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2007;
	CREATE TABLE IMC969SL.Outcomes_2007 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2007 AS a
		LEFT JOIN WORK.SEPSIS_2007 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2007 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2007 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2007 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;





/* Create Table of Outcomes for 2008 */
DATA WORK.InpatientStays_2008;
	SET	RIF2008.INPATIENT_CLAIMS_01
  		RIF2008.INPATIENT_CLAIMS_02
		RIF2008.INPATIENT_CLAIMS_03
		RIF2008.INPATIENT_CLAIMS_04
		RIF2008.INPATIENT_CLAIMS_05
		RIF2008.INPATIENT_CLAIMS_06
		RIF2008.INPATIENT_CLAIMS_07
		RIF2008.INPATIENT_CLAIMS_08
		RIF2008.INPATIENT_CLAIMS_09
		RIF2008.INPATIENT_CLAIMS_10
		RIF2008.INPATIENT_CLAIMS_11
		RIF2008.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2008;
	CREATE TABLE WORK.AllStays_2008 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2008 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2008;
	CREATE TABLE WORK.SSI_2008 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2008
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2008;
	CREATE TABLE WORK.PrimarySSI_2008 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2008
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2008;
	CREATE TABLE WORK.Sepsis_2008 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2008
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2008;
	CREATE TABLE WORK.PrimarySepsis_2008 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2008
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2008;
	CREATE TABLE WORK.AdmitsOnly_2008 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2008;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2008;
	CREATE TABLE IMC969SL.Outcomes_2008 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2008 AS a
		LEFT JOIN WORK.SEPSIS_2008 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2008 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2008 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2008 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;




/* Create Table of Outcomes for 2009 */
DATA WORK.InpatientStays_2009;
	SET	RIF2009.INPATIENT_CLAIMS_01
  		RIF2009.INPATIENT_CLAIMS_02
		RIF2009.INPATIENT_CLAIMS_03
		RIF2009.INPATIENT_CLAIMS_04
		RIF2009.INPATIENT_CLAIMS_05
		RIF2009.INPATIENT_CLAIMS_06
		RIF2009.INPATIENT_CLAIMS_07
		RIF2009.INPATIENT_CLAIMS_08
		RIF2009.INPATIENT_CLAIMS_09
		RIF2009.INPATIENT_CLAIMS_10
		RIF2009.INPATIENT_CLAIMS_11
		RIF2009.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2009;
	CREATE TABLE WORK.AllStays_2009 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2009 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2009;
	CREATE TABLE WORK.SSI_2009 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2009
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2009;
	CREATE TABLE WORK.PrimarySSI_2009 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2009
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2009;
	CREATE TABLE WORK.Sepsis_2009 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2009
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2009;
	CREATE TABLE WORK.PrimarySepsis_2009 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2009
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2009;
	CREATE TABLE WORK.AdmitsOnly_2009 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2009;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2009;
	CREATE TABLE IMC969SL.Outcomes_2009 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT, 
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2009 AS a
		LEFT JOIN WORK.SEPSIS_2009 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2009 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2009 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2009 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;



/* Create Table of Outcomes for 2010 */
DATA WORK.InpatientStays_2010;
	SET	RIF2010.INPATIENT_CLAIMS_01
  		RIF2010.INPATIENT_CLAIMS_02
		RIF2010.INPATIENT_CLAIMS_03
		RIF2010.INPATIENT_CLAIMS_04
		RIF2010.INPATIENT_CLAIMS_05
		RIF2010.INPATIENT_CLAIMS_06
		RIF2010.INPATIENT_CLAIMS_07
		RIF2010.INPATIENT_CLAIMS_08
		RIF2010.INPATIENT_CLAIMS_09
		RIF2010.INPATIENT_CLAIMS_10
		RIF2010.INPATIENT_CLAIMS_11
		RIF2010.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2010;
	CREATE TABLE WORK.AllStays_2010 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2010 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2010;
	CREATE TABLE WORK.SSI_2010 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2010
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2010;
	CREATE TABLE WORK.PrimarySSI_2010 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2010
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2010;
	CREATE TABLE WORK.Sepsis_2010 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2010
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2010;
	CREATE TABLE WORK.PrimarySepsis_2010 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2010
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2010;
	CREATE TABLE WORK.AdmitsOnly_2010 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2010;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2010;
	CREATE TABLE IMC969SL.Outcomes_2010 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2010 AS a
		LEFT JOIN WORK.SEPSIS_2010 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2010 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2010 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2010 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;




/* Create Table of Outcomes for 2011 */
DATA WORK.InpatientStays_2011;
	SET	RIF2011.INPATIENT_CLAIMS_01
  		RIF2011.INPATIENT_CLAIMS_02
		RIF2011.INPATIENT_CLAIMS_03
		RIF2011.INPATIENT_CLAIMS_04
		RIF2011.INPATIENT_CLAIMS_05
		RIF2011.INPATIENT_CLAIMS_06
		RIF2011.INPATIENT_CLAIMS_07
		RIF2011.INPATIENT_CLAIMS_08
		RIF2011.INPATIENT_CLAIMS_09
		RIF2011.INPATIENT_CLAIMS_10
		RIF2011.INPATIENT_CLAIMS_11
		RIF2011.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2011;
	CREATE TABLE WORK.AllStays_2011 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2011 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2011;
	CREATE TABLE WORK.SSI_2011 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2011
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2011;
	CREATE TABLE WORK.PrimarySSI_2011 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2011
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2011;
	CREATE TABLE WORK.Sepsis_2011 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2011
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2011;
	CREATE TABLE WORK.PrimarySepsis_2011 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2011
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2011;
	CREATE TABLE WORK.AdmitsOnly_2011 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2011;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2011;
	CREATE TABLE IMC969SL.Outcomes_2011 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2011 AS a
		LEFT JOIN WORK.SEPSIS_2011 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2011 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2011 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2011 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;



/* Create Table of Outcomes for 2012 */
DATA WORK.InpatientStays_2012;
	SET	RIF2012.INPATIENT_CLAIMS_01
  		RIF2012.INPATIENT_CLAIMS_02
		RIF2012.INPATIENT_CLAIMS_03
		RIF2012.INPATIENT_CLAIMS_04
		RIF2012.INPATIENT_CLAIMS_05
		RIF2012.INPATIENT_CLAIMS_06
		RIF2012.INPATIENT_CLAIMS_07
		RIF2012.INPATIENT_CLAIMS_08
		RIF2012.INPATIENT_CLAIMS_09
		RIF2012.INPATIENT_CLAIMS_10
		RIF2012.INPATIENT_CLAIMS_11
		RIF2012.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2012;
	CREATE TABLE WORK.AllStays_2012 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2012 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2012;
	CREATE TABLE WORK.SSI_2012 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2012
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2012;
	CREATE TABLE WORK.PrimarySSI_2012 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2012
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2012;
	CREATE TABLE WORK.Sepsis_2012 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2012
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2012;
	CREATE TABLE WORK.PrimarySepsis_2012 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2012
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2012;
	CREATE TABLE WORK.AdmitsOnly_2012 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2012;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2012;
	CREATE TABLE IMC969SL.Outcomes_2012 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2012 AS a
		LEFT JOIN WORK.SEPSIS_2012 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2012 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2012 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2012 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;



/* Create Table of Outcomes for 2013 */
DATA WORK.InpatientStays_2013;
	SET	RIF2013.INPATIENT_CLAIMS_01
  		RIF2013.INPATIENT_CLAIMS_02
		RIF2013.INPATIENT_CLAIMS_03
		RIF2013.INPATIENT_CLAIMS_04
		RIF2013.INPATIENT_CLAIMS_05
		RIF2013.INPATIENT_CLAIMS_06
		RIF2013.INPATIENT_CLAIMS_07
		RIF2013.INPATIENT_CLAIMS_08
		RIF2013.INPATIENT_CLAIMS_09
		RIF2013.INPATIENT_CLAIMS_10
		RIF2013.INPATIENT_CLAIMS_11
		RIF2013.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2013;
	CREATE TABLE WORK.AllStays_2013 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2013 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2013;
	CREATE TABLE WORK.SSI_2013 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2013
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2013;
	CREATE TABLE WORK.PrimarySSI_2013 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2013
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2013;
	CREATE TABLE WORK.Sepsis_2013 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2013
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2013;
	CREATE TABLE WORK.PrimarySepsis_2013 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2013
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2013;
	CREATE TABLE WORK.AdmitsOnly_2013 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2013;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2013;
	CREATE TABLE IMC969SL.Outcomes_2013 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2013 AS a
		LEFT JOIN WORK.SEPSIS_2013 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2013 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2013 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2013 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;




/* Create Table of Outcomes for 2014 */
DATA WORK.InpatientStays_2014;
	SET	RIF2014.INPATIENT_CLAIMS_01
  		RIF2014.INPATIENT_CLAIMS_02
		RIF2014.INPATIENT_CLAIMS_03
		RIF2014.INPATIENT_CLAIMS_04
		RIF2014.INPATIENT_CLAIMS_05
		RIF2014.INPATIENT_CLAIMS_06
		RIF2014.INPATIENT_CLAIMS_07
		RIF2014.INPATIENT_CLAIMS_08
		RIF2014.INPATIENT_CLAIMS_09
		RIF2014.INPATIENT_CLAIMS_10
		RIF2014.INPATIENT_CLAIMS_11
		RIF2014.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2014;
	CREATE TABLE WORK.AllStays_2014 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2014 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2014;
	CREATE TABLE WORK.SSI_2014 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2014
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2014;
	CREATE TABLE WORK.PrimarySSI_2014 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2014
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2014;
	CREATE TABLE WORK.Sepsis_2014 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2014
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2014;
	CREATE TABLE WORK.PrimarySepsis_2014 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2014
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2014;
	CREATE TABLE WORK.AdmitsOnly_2014 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2014;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2014;
	CREATE TABLE IMC969SL.Outcomes_2014 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2014 AS a
		LEFT JOIN WORK.SEPSIS_2014 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2014 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2014 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2014 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;




/* Create Table of Outcomes for 2015 */
DATA WORK.InpatientStays_2015;
	SET	RIF2015.INPATIENT_CLAIMS_01
  		RIF2015.INPATIENT_CLAIMS_02
		RIF2015.INPATIENT_CLAIMS_03
		RIF2015.INPATIENT_CLAIMS_04
		RIF2015.INPATIENT_CLAIMS_05
		RIF2015.INPATIENT_CLAIMS_06
		RIF2015.INPATIENT_CLAIMS_07
		RIF2015.INPATIENT_CLAIMS_08
		RIF2015.INPATIENT_CLAIMS_09
		RIF2015.INPATIENT_CLAIMS_10
		RIF2015.INPATIENT_CLAIMS_11
		RIF2015.INPATIENT_CLAIMS_12;
RUN;

PROC SQL;
	DROP TABLE WORK.AllStays_2015;
	CREATE TABLE WORK.AllStays_2015 AS
	SELECT a.BENE_ID, a.CLM_ID, a.NCH_BENE_DSCHRG_DT, a.CLM_FROM_DT, a.CLM_THRU_DT, 
		a.CLM_DRG_CD, a.ADMTG_DGNS_CD, a.ICD_DGNS_CD1, a.PRNCPAL_DGNS_CD,
		a.ICD_DGNS_CD2, a.ICD_DGNS_CD3, a.ICD_DGNS_CD4, a.ICD_DGNS_CD5, a.ICD_DGNS_CD6, a.ICD_DGNS_CD7,
		a.ICD_DGNS_CD8, a.ICD_DGNS_CD9, a.ICD_DGNS_CD10, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT
	FROM WORK.InpatientStays_2015 AS a
	WHERE CLM_SRC_IP_ADMSN_CD IN ("1","2","3","7")
		  AND (NCH_CLM_TYPE_CD IN ("60", "61"))
		  AND (SUBSTR(a.PRVDR_NUM,3,2) NOT IN ("40", "41", "42", "43", "44", "20", "21", "22"))
		  AND (SUBSTR(a.PRVDR_NUM,3,1) NOT IN ("M", "S", "R", "T"))
		  AND (SUBSTR(a.PRVDR_NUM,1,4) NOT IN ("3025", "3026", "3027", "3028", "3029", "3030", "3031", "3032", "3033", "3034", "3035",
		  		"3036", "3037", "3038", "3039", "3040", "3041", "3042", "3043", "3044", "3045",
				"3046", "3047", "3048", "3049", "3050", "3051", "3052", "3053", "3054", "3055",
				"3056", "3057", "3058", "3059", "3060", "3061", "3062", "3063", "3064", "3065",
				"3066", "3067", "3068", "3069", "3070", "3071", "3072", "3073", "3074", "3075",
				"3076", "3077", "3078", "3079", "3080", "3081", "3082", "3083", "3084", "3085",
				"3086", "3087", "3088", "3089", "3090", "3091", "3092", "3093", "3094", "3095",
				"3096", "3097", "3098", "3099"));
QUIT;

PROC SQL;
	DROP TABLE WORK.SSI_2015;
	CREATE TABLE WORK.SSI_2015 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as SSI
	FROM WORK.AllStays_2015
	WHERE ICD_DGNS_CD1 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD2 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD3 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD4 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD5 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD6 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD7 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD8 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD9 IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR ICD_DGNS_CD10 IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySSI_2015;
	CREATE TABLE WORK.PrimarySSI_2015 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySSI
	FROM WORK.AllStays_2015
	WHERE ADMTG_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859")
		  OR PRNCPAL_DGNS_CD IN ("99832", "99831", "56722", "9985", "99851", "99859");
QUIT;


PROC SQL;
	DROP TABLE WORK.Sepsis_2015;
	CREATE TABLE WORK.Sepsis_2015 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as Sepsis
	FROM WORK.AllStays_2015
	WHERE ICD_DGNS_CD1 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD2 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD3 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD4 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD5 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD6 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD7 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD8 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD9 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR ICD_DGNS_CD10 IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.PrimarySepsis_2015;
	CREATE TABLE WORK.PrimarySepsis_2015 AS
	SELECT DISTINCT BENE_ID, CLM_ID, NCH_BENE_DSCHRG_DT, CLM_FROM_DT, CLM_THRU_DT, 1 as PrimarySepsis
	FROM WORK.AllStays_2015
	WHERE ADMTG_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980")
		OR PRNCPAL_DGNS_CD IN ("038","0380","0381","03810","03811","03812","03819","0382",
						   "0383","0384","03840","03841","03842","03843","03844","03849",
						   "0388","0389","78552","7907","99591","99592","9980");
QUIT;

PROC SQL;
	DROP TABLE WORK.AdmitsOnly_2015;
	CREATE TABLE WORK.AdmitsOnly_2015 AS
	SELECT DISTINCT BENE_ID, CLM_ID, CLM_FROM_DT
	FROM WORK.AllStays_2015;
QUIT;

PROC SQL;
	DROP TABLE IMC969SL.Outcomes_2015;
	CREATE TABLE IMC969SL.Outcomes_2015 AS
	SELECT a.BENE_ID, a.CLM_ID, a.CLM_FROM_DT, a.CLM_PMT_AMT, a.CLM_TOT_CHRG_AMT,
		CASE
			WHEN b.Sepsis IS NOT MISSING THEN b.Sepsis
			ELSE 0
		END AS Sepsis, 
		CASE
			WHEN c.SSI IS NOT MISSING THEN c.SSI
			ELSE 0
		END AS SSI,
		CASE
			WHEN d.PrimarySepsis IS NOT MISSING THEN d.PrimarySepsis
			ELSE 0
		END AS PrimarySepsis, 
		CASE
			WHEN e.PrimarySSI IS NOT MISSING THEN e.PrimarySSI
			ELSE 0
		END AS PrimarySSI
	FROM WORK.AllStays_2015 AS a
		LEFT JOIN WORK.SEPSIS_2015 AS b
			ON a.BENE_ID=b.BENE_ID AND a.CLM_ID=b.CLM_ID
		LEFT JOIN WORK.SSI_2015 AS c
			ON a.BENE_ID=c.BENE_ID AND a.CLM_ID=c.CLM_ID
		LEFT JOIN WORK.PrimarySEPSIS_2015 AS d
			ON a.BENE_ID=d.BENE_ID AND a.CLM_ID=d.CLM_ID
		LEFT JOIN WORK.PrimarySSI_2015 AS e
			ON a.BENE_ID=e.BENE_ID AND a.CLM_ID=e.CLM_ID;
QUIT;





%LET year_data=2015;
PROC SORT data=IMC969SL.Outcomes_&year_data out=WORK.Outcomes_&year_data;
	by BENE_ID CLM_FROM_DT;
RUN;

PROC TRANSPOSE data=WORK.Outcomes_&year_data out=WORK.ReshapeClaim_&year_data
	(drop=_NAME_ _LABEL_) prefix=Claim;
	var CLM_ID;
	by BENE_ID;
RUN;

PROC TRANSPOSE data=WORK.Outcomes_&year_data out=WORK.ReshapeAdmit_&year_data
	(drop=_NAME_ _LABEL_) prefix=Admit;
	var CLM_FROM_DT;
	by BENE_ID;
RUN;
	
PROC TRANSPOSE data=WORK.Outcomes_&year_data out=WORK.ReshapeSepsis_&year_data
	(drop=_NAME_ _LABEL_) prefix=Sepsis;
	var Sepsis;
	by BENE_ID;
RUN;

PROC TRANSPOSE data=WORK.Outcomes_&year_data out=WORK.ReshapeSSI_&year_data
	(drop=_NAME_ _LABEL_) prefix=SSI;
	var SSI;
	by BENE_ID;
RUN;

PROC TRANSPOSE data=WORK.Outcomes_&year_data out=WORK.ReshapePrimarySepsis_&year_data
	(drop=_NAME_ _LABEL_) prefix=PrimarySepsis;
	var PrimarySepsis;
	by BENE_ID;
RUN;

PROC TRANSPOSE data=WORK.Outcomes_&year_data out=WORK.ReshapePrimarySSI_&year_data
	(drop=_NAME_ _LABEL_) prefix=PrimarySSI;
	var PrimarySSI;
	by BENE_ID;
RUN;

PROC SORT data=ReshapeClaim_&year_data;
	by BENE_ID;
RUN;

PROC SORT data=ReshapeAdmit_&year_data;
	by BENE_ID;
RUN;

PROC SORT data=ReshapeSepsis_&year_data;
	by BENE_ID;
RUN;

PROC SORT data=ReshapeSSI_&year_data;
	by BENE_ID;
RUN;

PROC SORT data=ReshapePrimarySepsis_&year_data;
	by BENE_ID;
RUN;

PROC SORT data=ReshapePrimarySSI_&year_data;
	by BENE_ID;
RUN;

DATA IMC969SL.OutcomesReshape_&year_data;
 merge ReshapeClaim_&year_data(in=a)
 	   ReshapeAdmit_&year_data(in=b)
	   ReshapeSepsis_&year_data(in=c)
	   ReshapeSSI_&year_data(in=d)
	   ReshapePrimarySepsis_&year_data(in=e)
	   ReshapePrimarySSI_&year_data(in=f);
 by BENE_ID;
 if a=b=c=d=e=f;
RUN;